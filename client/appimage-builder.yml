version: 1

script:
  # Выполняется из корня проекта ./client
  - rm -rf AppDir || true
  - mkdir -p AppDir
  - cp -r build/linux/x64/release/bundle/* AppDir/
  - mkdir -p AppDir/usr/share/icons/hicolor/256x256/apps
  - cp appimage_builder/client.png AppDir/usr/share/icons/hicolor/256x256/apps/com.yourcompany.todo.png
  - cp appimage_builder/client.desktop AppDir/com.yourcompany.todo.desktop

AppDir:
  path: ./AppDir

  app_info:
    id: com.yourcompany.todo
    name: ToDo
    icon: com.yourcompany.todo
    version: 1.0.0
    exec: bundle/client
    exec_args: $@

  apt:
    arch: amd64
    sources:
      # ИСПРАВЛЕНО: Убран несовместимый синтаксис [trusted=yes].
      # Проблема доверия будет решена в самом workflow-файле через apt-key.
      - sourceline: "deb http://archive.ubuntu.com/ubuntu/ focal main restricted universe multiverse"
    include:
      - libgtk-3-0
      - libsecret-1-0
      - libnotify4
      - libayatana-appindicator3-1
      - libjson-glib-1.0-0

  files:
    exclude:
      - usr/share/man
      - usr/share/doc/*/README.*
      - usr/share/doc/*/changelog.*
      - usr/share/doc/*/copyright

AppImage:
  arch: x86_64
  update-information: guess
  sign-key: None